<!DOCTYPE html>
<html lang="en">
  <head>
    {% load static %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grade Calculator</title>
    <link rel="stylesheet" href="{% static 'app_plan/style.css' %}" />
  </head>
  <body>
    <header class="header">
      <div class="logo-container">
        <img
          src="{% static 'app_grade/image/logo.jpg' %}"
          class="logo"
          alt="Logo"
        />
        <span class="logo-text">Grade Planner</span>
      </div>
      <button
        class="try-it-btn"
        onclick="window.location.href='{% url 'home' %}'"
      >
        Home
      </button>
    </header>
    <div class="dark-mode-container">
      <button class="dark-mode-toggle" onclick="toggleDarkMode()">
        üåô Dark Mode
      </button>
    </div>
    <div class="card">
      <div class="card-title">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏Å‡∏£‡∏î</div>
      <form id="grade-form">
        <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
        <div class="form-group">
          <label
            >‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß (‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤ S/U/T)
            <span style="color: red">*</span></label
          >
          <input
            type="number"
            name="current_credits"
            placeholder="‡πÄ‡∏ä‡πà‡∏ô 60"
            min="0"
            required
          />
        </div>
        <div class="form-group">
          <label>‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô <span style="color: red">*</span></label>
          <input
            type="number"
            name="current_gpa"
            placeholder="‡πÄ‡∏ä‡πà‡∏ô 3.50"
            step="0.01"
            min="0"
            max="4"
            required
          />
        </div>
        <div class="form-group">
          <label>‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ <span style="color: red">*</span></label>
          <input
            type="number"
            name="target_gpa"
            placeholder="‡πÄ‡∏ä‡πà‡∏ô 3.75"
            step="0.01"
            min="0"
            max="4"
            required
          />
        </div>
        <div class="form-group">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ 1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
          <input
            type="number"
            name="courses_1_credit"
            placeholder="0"
            min="0"
          />
        </div>
        <div class="form-group">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ 2 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
          <input
            type="number"
            name="courses_2_credits"
            placeholder="0"
            min="0"
          />
        </div>
        <div class="form-group">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ 3 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
          <input
            type="number"
            name="courses_3_credits"
            placeholder="0"
            min="0"
          />
        </div>

        <div class="form-group">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ 4 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
          <input
            type="number"
            name="courses_4_credits"
            placeholder="0"
            min="0"
          />
        </div>
        <div class="form-group">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ 5 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
          <input
            type="number"
            name="courses_5_credits"
            placeholder="0"
            min="0"
          />
        </div>
        <div class="form-group">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ 6 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
          <input
            type="number"
            name="courses_6_credits"
            placeholder="0"
            min="0"
          />
        </div>
        <button type="button" class="btn" onclick="validateAndCalculate()">
          ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
        </button>
      </form>
      <div id="result" class="result" style="display: none">
        <p id="result-text"></p>
        <div id="plans"></div>
      </div>
    </div>

    <script>
      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Dark Mode ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Local Storage
        if (document.body.classList.contains("dark-mode")) {
          localStorage.setItem("darkMode", "enabled");
        } else {
          localStorage.setItem("darkMode", "disabled");
        }
      }

      // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏¥‡∏î Dark Mode ‡πÑ‡∏ß‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
      window.onload = function () {
        if (localStorage.getItem("darkMode") === "enabled") {
          document.body.classList.add("dark-mode");
        }
      };
      function validateAndCalculate() {
        const form = document.getElementById("grade-form");
        const inputs = form.querySelectorAll("[required]");
        let valid = true;

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
        inputs.forEach((input) => {
          if (!input.value) {
            input.style.border = "1px solid red";
            valid = false;
          } else {
            input.style.border = "";
          }
        });

        /*if (!valid) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ *");
          return;
        }*/

        const formData = new FormData(form);
        fetch("{% url 'grade_calculator' %}", {
          method: "POST",
          headers: { "X-CSRFToken": "{{ csrf_token }}" },
          body: formData,
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå");
            }
            return response.json();
          })
          .then((data) => {
            const resultDiv = document.getElementById("result");
            resultDiv.style.display = "block";
            document.getElementById("result-text").innerHTML = data.result;

            const plansDiv = document.getElementById("plans");
            plansDiv.innerHTML = ""; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤

            // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÄ‡∏Å‡∏£‡∏î
            data.distributions.forEach((distribution, index) => {
              let section = `<h4>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà ${index + 1} (‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${
                distribution.avgGrade || "N/A"
              }):</h4>`;

              [6, 5, 4, 3, 2, 1].forEach((credit) => {
                if (
                  distribution[credit] &&
                  Object.values(distribution[credit]).some((count) => count > 0)
                ) {
                  let creditSection = `<p>‡∏ß‡∏¥‡∏ä‡∏≤ ${credit} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï:</p><ul>`;
                  Object.entries(distribution[credit]).forEach(
                    ([grade, count]) => {
                      if (count > 0) {
                        creditSection += `<li>‡πÄ‡∏Å‡∏£‡∏î ${grade}: ${count} ‡∏ß‡∏¥‡∏ä‡∏≤</li>`;
                      }
                    }
                  );
                  creditSection += `</ul>`;
                  section += creditSection;
                }
              });
              section += `<hr class="plan-divider">`;
              plansDiv.innerHTML += section;
            });
          })
          .catch((error) => {
            console.error("Error:", error); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô Console ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
          });
      }
    </script>
  </body>
</html>
